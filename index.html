<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Registro de Manutenções</title>
  
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  
  <!-- CSS personalizado -->
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
  <div class="container-fluid p-0">
    <!-- Cabeçalho -->
    <header class="bg-primary text-white py-3 px-4 shadow">
      <div class="d-flex justify-content-between align-items-center">
        <h1 class="h4 mb-0"><i class="bi bi-tools me-2"></i> Sistema de Registro de Manutenções</h1>
        <div>
          <button class="btn btn-outline-light btn-sm me-2" id="btnListaRegistros">
            <i class="bi bi-list-ul"></i> Registros
          </button>
          <button class="btn btn-outline-light btn-sm" id="btnNovoRegistro">
            <i class="bi bi-plus-circle"></i> Novo
          </button>
        </div>
      </div>
    </header>

    <!-- Conteúdo principal - telas do sistema -->
    <main class="container py-4">
      <!-- 1. Lista de Registros -->
      <section id="telaListaRegistros" class="tela-sistema">
        <div class="card shadow-sm mb-4">
          <div class="card-header bg-light">
            <div class="d-flex justify-content-between align-items-center">
              <h2 class="h5 mb-0">Registros de Manutenção</h2>
              <div class="input-group" style="max-width: 300px;">
                <input type="text" class="form-control form-control-sm" placeholder="Buscar..." id="buscaRegistro">
                <button class="btn btn-sm btn-outline-secondary" type="button" id="btnBuscar">
                  <i class="bi bi-search"></i>
                </button>
              </div>
            </div>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Placa</th>
                    <th>Modelo</th>
                    <th>Data</th>
                    <th>Status</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody id="listaRegistrosBody">
                  <!-- Será preenchido via JavaScript -->
                  <tr>
                    <td colspan="6" class="text-center py-4">
                      <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Carregando...</span>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- 2. Tela de Registro PRÉ-manutenção -->
      <section id="telaPreManutencao" class="tela-sistema" style="display: none;">
        <div class="card shadow-sm mb-4">
          <div class="card-header bg-primary text-white">
            <div class="d-flex justify-content-between align-items-center">
              <h2 class="h5 mb-0"><i class="bi bi-wrench-adjustable-circle me-2"></i> Registro PRÉ-manutenção</h2>
              <div id="registroIdDisplay" class="badge bg-light text-primary"></div>
            </div>
          </div>
          <div class="card-body">
            <form id="formPreManutencao" class="needs-validation" novalidate>
              <input type="hidden" id="registroId">
              
              <!-- Informações do Veículo -->
              <div class="mb-4">
                <h5 class="border-bottom pb-2">Informações do Veículo</h5>
                <div class="row g-3">
                  <div class="col-md-6">
                    <label for="placa" class="form-label">Placa <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="placa" required>
                    <div class="invalid-feedback">Informe a placa do veículo</div>
                  </div>
                  <div class="col-md-6">
                    <label for="modelo" class="form-label">Modelo <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="modelo" required>
                    <div class="invalid-feedback">Informe o modelo do veículo</div>
                  </div>
                  <div class="col-md-6">
                    <label for="idInterna" class="form-label">ID Interna <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="idInterna" required>
                    <div class="invalid-feedback">Informe a ID interna do equipamento</div>
                  </div>
                  <div class="col-md-6">
                    <label for="quilometragem" class="form-label">Quilometragem</label>
                    <input type="number" class="form-control" id="quilometragem">
                  </div>
                </div>
              </div>
              
              <!-- Informações do Problema -->
              <div class="mb-4">
                <h5 class="border-bottom pb-2">Detalhes do Problema</h5>
                <div class="row g-3">
                  <div class="col-md-6">
                    <label for="categoriaProblema" class="form-label">Categoria <span class="text-danger">*</span></label>
                    <select class="form-select" id="categoriaProblema" required>
                      <option value="" selected disabled>Selecione...</option>
                      <option value="Motor">Motor</option>
                      <option value="Sistema Hidráulico">Sistema Hidráulico</option>
                      <option value="Bomba">Bomba</option>
                      <option value="Transmissão">Transmissão</option>
                      <option value="Elétrica">Elétrica</option>
                      <option value="Freios">Freios</option>
                      <option value="Suspensão">Suspensão</option>
                      <option value="Carroceria">Carroceria</option>
                      <option value="Outro">Outro</option>
                    </select>
                    <div class="invalid-feedback">Selecione a categoria do problema</div>
                  </div>
                  <div class="col-md-6">
                    <label for="urgencia" class="form-label">Urgência <span class="text-danger">*</span></label>
                    <select class="form-select" id="urgencia" required>
                      <option value="" selected disabled>Selecione...</option>
                      <option value="Baixa">Baixa</option>
                      <option value="Média">Média</option>
                      <option value="Alta">Alta</option>
                      <option value="Crítica">Crítica</option>
                    </select>
                    <div class="invalid-feedback">Selecione o nível de urgência</div>
                  </div>
                  <div class="col-12">
                    <label for="descricaoProblema" class="form-label">Descrição do Problema <span class="text-danger">*</span></label>
                    <textarea class="form-control" id="descricaoProblema" rows="3" required></textarea>
                    <div class="invalid-feedback">Descreva o problema</div>
                  </div>
                </div>
              </div>

              <!-- Checklist PRÉ -->
              <div class="mb-4">
                <h5 class="border-bottom pb-2">Checklist de Condições</h5>
                <div class="row g-3">
                  <div class="col-md-4">
                    <label class="form-label d-block">Sistema Hidráulico</label>
                    <div class="btn-group" role="group">
                      <input type="radio" class="btn-check" name="hidraulico" id="hidraulicoOk" value="OK" required>
                      <label class="btn btn-outline-success" for="hidraulicoOk">OK</label>
                      <input type="radio" class="btn-check" name="hidraulico" id="hidraulicoDanificado" value="Danificado">
                      <label class="btn btn-outline-danger" for="hidraulicoDanificado">Danificado</label>
                      <input type="radio" class="btn-check" name="hidraulico" id="hidraulicoNa" value="N/A">
                      <label class="btn btn-outline-secondary" for="hidraulicoNa">N/A</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <label class="form-label d-block">Sistema Elétrico</label>
                    <div class="btn-group" role="group">
                      <input type="radio" class="btn-check" name="eletrico" id="eletricoOk" value="OK" required>
                      <label class="btn btn-outline-success" for="eletricoOk">OK</label>
                      <input type="radio" class="btn-check" name="eletrico" id="eletricoDanificado" value="Danificado">
                      <label class="btn btn-outline-danger" for="eletricoDanificado">Danificado</label>
                      <input type="radio" class="btn-check" name="eletrico" id="eletricoNa" value="N/A">
                      <label class="btn btn-outline-secondary" for="eletricoNa">N/A</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <label class="form-label d-block">Bomba</label>
                    <div class="btn-group" role="group">
                      <input type="radio" class="btn-check" name="bomba" id="bombaOk" value="OK" required>
                      <label class="btn btn-outline-success" for="bombaOk">OK</label>
                      <input type="radio" class="btn-check" name="bomba" id="bombaDanificado" value="Danificado">
                      <label class="btn btn-outline-danger" for="bombaDanificado">Danificado</label>
                      <input type="radio" class="btn-check" name="bomba" id="bombaNa" value="N/A">
                      <label class="btn btn-outline-secondary" for="bombaNa">N/A</label>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Registro Fotográfico -->
              <div class="mb-4">
                <h5 class="border-bottom pb-2">Registro Fotográfico</h5>
                <div class="d-flex mb-2 gap-2">
                  <button type="button" class="btn btn-primary btn-sm" id="btnCapturarFotoPre">
                    <i class="bi bi-camera-fill me-1"></i> Capturar
                  </button>
                  <button type="button" class="btn btn-secondary btn-sm" id="btnSelecionarFotoPre">
                    <i class="bi bi-image me-1"></i> Da Galeria
                  </button>
                </div>
                <div id="fotosPreContainer" class="foto-container">
                  <div class="text-center p-4 border rounded" id="fotosPrePlaceholder">
                    <i class="bi bi-camera text-muted fs-1 d-block mb-2"></i>
                    <p class="text-muted mb-0">Nenhuma foto adicionada</p>
                  </div>
                  <div id="fotosPreGrid" class="row g-2"></div>
                </div>
                <input type="file" id="fotoPreInput" class="d-none" accept="image/*">
              </div>

              <!-- Observações -->
              <div class="mb-4">
                <label for="observacoesPre" class="form-label">Observações Adicionais</label>
                <textarea class="form-control" id="observacoesPre" rows="2"></textarea>
              </div>

              <!-- Informações do Responsável -->
              <div class="mb-4">
                <h5 class="border-bottom pb-2">Responsável</h5>
                <div class="row g-3">
                  <div class="col-md-6">
                    <label for="responsavel" class="form-label">Nome <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="responsavel" required>
                    <div class="invalid-feedback">Informe o nome do responsável</div>
                  </div>
                </div>
              </div>

              <!-- Botões de ação -->
              <div class="text-end mt-4">
                <button type="button" class="btn btn-outline-secondary me-2" id="btnCancelarPre">Cancelar</button>
                <button type="submit" class="btn btn-primary">Salvar e Avançar</button>
              </div>
            </form>
          </div>
        </div>
      </section>

      <!-- 3. Tela de Registro PÓS-manutenção -->
      <section id="telaPosManutencao" class="tela-sistema" style="display: none;">
        <div class="card shadow-sm mb-4">
          <div class="card-header bg-success text-white">
            <div class="d-flex justify-content-between align-items-center">
              <h2 class="h5 mb-0"><i class="bi bi-check2-circle me-2"></i> Registro PÓS-manutenção</h2>
              <div id="registroIdPosDisplay" class="badge bg-light text-success"></div>
            </div>
          </div>
          <div class="card-body">
            <form id="formPosManutencao" class="needs-validation" novalidate>
              <input type="hidden" id="registroIdPos">
              
              <!-- Informações do Veículo (resumo) -->
              <div class="mb-4">
                <div class="alert alert-light shadow-sm">
                  <div class="row">
                    <div class="col-md-4"><strong>Placa:</strong> <span id="placaPos"></span></div>
                    <div class="col-md-4"><strong>Modelo:</strong> <span id="modeloPos"></span></div>
                    <div class="col-md-4"><strong>ID Interna:</strong> <span id="idInternaPos"></span></div>
                  </div>
                </div>
              </div>
              
              <!-- Checklist PÓS -->
              <div class="mb-4">
                <h5 class="border-bottom pb-2">Checklist Pós-Manutenção</h5>
                <div class="row g-3">
                  <div class="col-md-4">
                    <label class="form-label d-block">Sistema Hidráulico</label>
                    <div class="btn-group" role="group">
                      <input type="radio" class="btn-check" name="hidraulicoPos" id="hidraulicoPosOk" value="OK" required>
                      <label class="btn btn-outline-success" for="hidraulicoPosOk">OK</label>
                      <input type="radio" class="btn-check" name="hidraulicoPos" id="hidraulicoPosDanificado" value="Danificado">
                      <label class="btn btn-outline-danger" for="hidraulicoPosDanificado">Danificado</label>
                      <input type="radio" class="btn-check" name="hidraulicoPos" id="hidraulicoPosNa" value="N/A">
                      <label class="btn btn-outline-secondary" for="hidraulicoPosNa">N/A</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <label class="form-label d-block">Sistema Elétrico</label>
                    <div class="btn-group" role="group">
                      <input type="radio" class="btn-check" name="eletricoPos" id="eletricoPosOk" value="OK" required>
                      <label class="btn btn-outline-success" for="eletricoPosOk">OK</label>
                      <input type="radio" class="btn-check" name="eletricoPos" id="eletricoPosDanificado" value="Danificado">
                      <label class="btn btn-outline-danger" for="eletricoPosDanificado">Danificado</label>
                      <input type="radio" class="btn-check" name="eletricoPos" id="eletricoPosNa" value="N/A">
                      <label class="btn btn-outline-secondary" for="eletricoPosNa">N/A</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <label class="form-label d-block">Bomba</label>
                    <div class="btn-group" role="group">
                      <input type="radio" class="btn-check" name="bombaPos" id="bombaPosOk" value="OK" required>
                      <label class="btn btn-outline-success" for="bombaPosOk">OK</label>
                      <input type="radio" class="btn-check" name="bombaPos" id="bombaPosDanificado" value="Danificado">
                      <label class="btn btn-outline-danger" for="bombaPosDanificado">Danificado</label>
                      <input type="radio" class="btn-check" name="bombaPos" id="bombaPosNa" value="N/A">
                      <label class="btn btn-outline-secondary" for="bombaPosNa">N/A</label>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Registro Fotográfico PÓS -->
              <div class="mb-4">
                <h5 class="border-bottom pb-2">Registro Fotográfico Pós-Manutenção</h5>
                <div class="d-flex mb-2 gap-2">
                  <button type="button" class="btn btn-primary btn-sm" id="btnCapturarFotoPos">
                    <i class="bi bi-camera-fill me-1"></i> Capturar
                  </button>
                  <button type="button" class="btn btn-secondary btn-sm" id="btnSelecionarFotoPos">
                    <i class="bi bi-image me-1"></i> Da Galeria
                  </button>
                </div>
                <div id="fotosPosContainer" class="foto-container">
                  <div class="text-center p-4 border rounded" id="fotosPosPlaceholder">
                    <i class="bi bi-camera text-muted fs-1 d-block mb-2"></i>
                    <p class="text-muted mb-0">Nenhuma foto adicionada</p>
                  </div>
                  <div id="fotosPosGrid" class="row g-2"></div>
                </div>
                <input type="file" id="fotoPosInput" class="d-none" accept="image/*">
              </div>

              <!-- Observações -->
              <div class="mb-4">
                <label for="observacoesPos" class="form-label">Observações Pós-Manutenção</label>
                <textarea class="form-control" id="observacoesPos" rows="3"></textarea>
              </div>

              <!-- Botões de ação -->
              <div class="text-end mt-4">
                <button type="button" class="btn btn-outline-secondary me-2" id="btnVoltarPre">Voltar</button>
                <button type="submit" class="btn btn-success">Finalizar Registro</button>
              </div>
            </form>
          </div>
        </div>
      </section>

      <!-- 4. Tela de Visualização do Registro -->
      <section id="telaVisualizacao" class="tela-sistema" style="display: none;">
        <div class="card shadow-sm mb-4">
          <div class="card-header bg-info text-white">
            <div class="d-flex justify-content-between align-items-center">
              <h2 class="h5 mb-0"><i class="bi bi-eye me-2"></i> Visualização do Registro</h2>
              <div>
                <span id="registroIdVisualizar" class="badge bg-light text-info me-2"></span>
                <button class="btn btn-sm btn-light" id="btnVoltarLista">
                  <i class="bi bi-arrow-left"></i> Voltar
                </button>
                <button class="btn btn-sm btn-warning ms-2" id="btnEditar">
                  <i class="bi bi-pencil"></i> Editar
                </button>
              </div>
            </div>
          </div>
          <div class="card-body">
            <div class="row mb-4">
              <div class="col-md-12">
                <div class="alert alert-light shadow-sm">
                  <div class="row g-2">
                    <div class="col-md-3"><strong>Placa:</strong> <span id="placaView"></span></div>
                    <div class="col-md-3"><strong>Modelo:</strong> <span id="modeloView"></span></div>
                    <div class="col-md-3"><strong>ID Interna:</strong> <span id="idInternaView"></span></div>
                    <div class="col-md-3"><strong>Data:</strong> <span id="dataView"></span></div>
                    <div class="col-md-3"><strong>Responsável:</strong> <span id="responsavelView"></span></div>
                    <div class="col-md-3"><strong>Status:</strong> <span id="statusView"></span></div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Comparação Antes/Depois -->
            <div class="row">
              <div class="col-md-6">
                <div class="card border-primary h-100">
                  <div class="card-header bg-primary text-white">
                    <h5 class="h6 mb-0">Antes da Manutenção</h5>
                  </div>
                  <div class="card-body">
                    <h6>Problema Relatado</h6>
                    <p id="descricaoProblemaView"></p>
                    
                    <h6>Checklist Pré-Manutenção</h6>
                    <table class="table table-sm table-bordered">
                      <tbody id="checklistPreView">
                        <!-- Preenchido via JS -->
                      </tbody>
                    </table>
                    
                    <h6>Fotos Pré-Manutenção</h6>
                    <div id="fotosPreView" class="row g-2">
                      <!-- Preenchido via JS -->
                    </div>
                    
                    <h6>Observações</h6>
                    <p id="observacoesPreView"></p>
                  </div>
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="card border-success h-100">
                  <div class="card-header bg-success text-white">
                    <h5 class="h6 mb-0">Depois da Manutenção</h5>
                  </div>
                  <div class="card-body">
                    <h6>Checklist Pós-Manutenção</h6>
                    <table class="table table-sm table-bordered">
                      <tbody id="checklistPosView">
                        <!-- Preenchido via JS -->
                      </tbody>
                    </table>
                    
                    <h6>Fotos Pós-Manutenção</h6>
                    <div id="fotosPosView" class="row g-2">
                      <!-- Preenchido via JS -->
                    </div>
                    
                    <h6>Observações</h6>
                    <p id="observacoesPosView"></p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Modal para Captura de Fotos -->
    <div class="modal fade" id="modalCamera" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title" id="modalCameraTitle">Capturar Foto</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
          </div>
          <div class="modal-body">
            <div class="camera-container mb-3">
              <video id="cameraPreview" class="w-100" autoplay></video>
              <canvas id="photoCanvas" class="d-none"></canvas>
            </div>
            <div id="capturedPhotoContainer" class="d-none mb-3">
              <img id="capturedPhoto" class="img-fluid rounded mx-auto d-block" alt="Foto capturada">
            </div>
            <div id="photoDetailsForm" class="d-none">
              <div class="mb-3">
                <label for="descricaoFoto" class="form-label">Descrição da Foto</label>
                <input type="text" class="form-control" id="descricaoFoto" placeholder="Descreva o que esta imagem mostra">
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="button" class="btn btn-primary" id="btnCapturar">Capturar</button>
            <button type="button" class="btn btn-success d-none" id="btnSalvarFoto">Salvar Foto</button>
            <button type="button" class="btn btn-outline-primary d-none" id="btnNovaFoto">Nova Foto</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Notificações -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
      <div id="notificationToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
          <strong class="me-auto" id="toastTitle">Notificação</strong>
          <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Fechar"></button>
        </div>
        <div class="toast-body" id="toastMessage">
          Mensagem de notificação
        </div>
      </div>
    </div>
    
    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center bg-dark bg-opacity-25" style="display: none !important; z-index: 9999;">
      <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
        <span class="visually-hidden">Carregando...</span>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Scripts da aplicação -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/photo-handler.js"></script>
    <script src="js/api-client.js"></script>
    <script src="js/form-handler.js"></script>
    <script src="js/app.js"></script>
  </div>
</body>
</html>s
