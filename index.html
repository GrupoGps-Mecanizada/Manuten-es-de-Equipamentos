<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Registro de Manutenções</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
  <div class="container-fluid p-0">
    <header class="bg-primary text-white py-3 px-4 shadow">
      <div class="d-flex justify-content-between align-items-center">
        <h1 class="h4 mb-0"><i class="bi bi-tools me-2"></i> Sistema de Registro de Manutenções</h1>
        <div>
          <button class="btn btn-outline-light btn-sm me-2" id="btnListaRegistros">
            <i class="bi bi-list-ul"></i> Registros
          </button>
          <button class="btn btn-outline-light btn-sm" id="btnNovoRegistro">
            <i class="bi bi-plus-circle"></i> Novo
          </button>
          </div>
      </div>
    </header>

    <main class="container py-4">
      <section id="telaListaRegistros" class="tela-sistema">
        <div class="card shadow-sm mb-4">
          <div class="card-header bg-light">
            <div class="d-flex justify-content-between align-items-center">
              <h2 class="h5 mb-0">Registros de Manutenção</h2>
              <div class="input-group" style="max-width: 300px;">
                <input type="text" class="form-control form-control-sm" placeholder="Buscar..." id="buscaRegistro">
                <button class="btn btn-sm btn-outline-secondary" type="button" id="btnBuscar">
                  <i class="bi bi-search"></i>
                </button>
              </div>
            </div>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Placa</th>
                    <th>Modelo</th>
                    <th>Data</th>
                    <th>Status</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody id="listaRegistrosBody">
                  <tr>
                    <td colspan="6" class="text-center py-4">
                      <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Carregando...</span>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <section id="telaPreManutencao" class="tela-sistema" style="display: none;">
        <div class="card shadow-sm mb-4">
          <div class="card-header bg-primary text-white">
            <div class="d-flex justify-content-between align-items-center">
              <h2 class="h5 mb-0"><i class="bi bi-wrench-adjustable-circle me-2"></i> Registro PRÉ-manutenção</h2>
              <div id="registroIdDisplay" class="badge bg-light text-primary"></div>
            </div>
          </div>
          <div class="card-body">
            <form id="formPreManutencao" class="needs-validation" novalidate>
              <input type="hidden" id="registroId">

              <div class="mb-4">
                <h5 class="form-section-title border-bottom pb-2">Informações do Veículo</h5>
                <div class="row g-3">
                  <div class="col-md-6">
                    <label for="placa" class="form-label">Placa <span class="text-danger">*</span></label>
                    <input type="text" class="form-control enhanced-input" id="placa" required data-validate="placa">
                    <div class="invalid-feedback">Informe uma placa válida (AAA-1234 ou AAA1A34)</div>
                  </div>
                  <div class="col-md-6">
                    <label for="modelo" class="form-label">Modelo <span class="text-danger">*</span></label>
                    <input type="text" class="form-control enhanced-input" id="modelo" required data-validate="text" data-max-length="100">
                    <div class="invalid-feedback">Informe o modelo do veículo</div>
                  </div>
                  <div class="col-md-6">
                    <label for="idInterna" class="form-label">ID Interna <span class="text-danger">*</span></label>
                    <input type="text" class="form-control enhanced-input" id="idInterna" required data-validate="text" data-max-length="50">
                    <div class="invalid-feedback">Informe a ID interna do equipamento</div>
                  </div>
                  <div class="col-md-6">
                    <label for="quilometragem" class="form-label">Quilometragem</label>
                    <input type="number" class="form-control enhanced-input" id="quilometragem" data-validate="km" data-required="false">
                     <div class="invalid-feedback">Informe uma quilometragem válida</div>
                  </div>
                </div>
              </div>

              <div class="mb-4">
                <h5 class="form-section-title border-bottom pb-2">Detalhes do Problema</h5>
                <div class="row g-3">
                  <div class="col-md-6">
                    <label for="categoriaProblema" class="form-label">Categoria <span class="text-danger">*</span></label>
                    <select class="form-select enhanced-input" id="categoriaProblema" required>
                      <option value="" selected disabled>Selecione...</option>
                      </select>
                    <div class="invalid-feedback">Selecione a categoria do problema</div>
                  </div>
                  <div class="col-md-6">
                    <label for="urgencia" class="form-label">Urgência <span class="text-danger">*</span></label>
                    <select class="form-select enhanced-input" id="urgencia" required>
                       <option value="" selected disabled>Selecione...</option>
                       </select>
                    <div class="invalid-feedback">Selecione o nível de urgência</div>
                  </div>
                  <div class="col-12">
                    <label for="descricaoProblema" class="form-label">Descrição do Problema <span class="text-danger">*</span></label>
                    <textarea class="form-control enhanced-input" id="descricaoProblema" rows="3" required data-validate="text" data-max-length="500"></textarea>
                    <div class="invalid-feedback">Descreva o problema detalhadamente</div>
                  </div>
                </div>
              </div>

              <div class="mb-4">
                <h5 class="form-section-title border-bottom pb-2">Checklist de Condições</h5>
                <div id="checklistPreContainer" class="row g-3">
                    <p class="text-muted">Carregando checklist...</p>
                </div>
              </div>

              <div class="mb-4" id="photo-section-pre">
                 <h5 class="form-section-title border-bottom pb-2">Registro Fotográfico PRÉ</h5>
                 <div id="photo-container-pre">
                    </div>
               </div>

              <div class="mb-4">
                <label for="observacoesPre" class="form-label">Observações Adicionais</label>
                <textarea class="form-control enhanced-input" id="observacoesPre" rows="2" data-validate="text" data-max-length="500" data-required="false"></textarea>
                 <div class="invalid-feedback">Máximo de 500 caracteres</div>
              </div>

              <div class="mb-4">
                <h5 class="form-section-title border-bottom pb-2">Responsável</h5>
                <div class="row g-3">
                  <div class="col-md-6">
                    <label for="responsavel" class="form-label">Nome <span class="text-danger">*</span></label>
                    <input type="text" class="form-control enhanced-input" id="responsavel" required data-validate="text" data-max-length="100">
                    <div class="invalid-feedback">Informe o nome do responsável</div>
                  </div>
                </div>
              </div>

              <div class="text-end mt-4">
                <button type="button" class="btn btn-outline-secondary me-2" id="btnCancelarPre">Cancelar</button>
                <button type="submit" class="btn btn-primary">Salvar e Avançar</button>
              </div>
            </form>
          </div>
        </div>
      </section>

      <section id="telaPosManutencao" class="tela-sistema" style="display: none;">
        <div class="card shadow-sm mb-4">
          <div class="card-header bg-success text-white">
            <div class="d-flex justify-content-between align-items-center">
              <h2 class="h5 mb-0"><i class="bi bi-check2-circle me-2"></i> Registro PÓS-manutenção</h2>
              <div id="registroIdPosDisplay" class="badge bg-light text-success"></div>
            </div>
          </div>
          <div class="card-body">
            <form id="formPosManutencao" class="needs-validation" novalidate>
              <input type="hidden" id="registroIdPos">

              <div class="mb-4">
                 <h5 class="form-section-title border-bottom pb-2">Resumo do Veículo</h5>
                 <div class="alert alert-secondary">
                    <div class="row g-2">
                       <div class="col-md-4"><strong>Placa:</strong> <span id="placaPos">--</span></div>
                       <div class="col-md-4"><strong>Modelo:</strong> <span id="modeloPos">--</span></div>
                       <div class="col-md-4"><strong>ID Interna:</strong> <span id="idInternaPos">--</span></div>
                    </div>
                 </div>
              </div>

              <div class="mb-4">
                <h5 class="form-section-title border-bottom pb-2">Checklist Pós-Manutenção</h5>
                 <div id="checklistPosContainer" class="row g-3">
                    <p class="text-muted">Carregando checklist...</p>
                 </div>
              </div>

               <div class="mb-4" id="photo-section-pos">
                 <h5 class="form-section-title border-bottom pb-2">Registro Fotográfico PÓS</h5>
                  <div id="photo-container-pos">
                      </div>
               </div>

              <div class="mb-4">
                <label for="observacoesPos" class="form-label">Observações Pós-Manutenção</label>
                <textarea class="form-control enhanced-input" id="observacoesPos" rows="3" data-validate="text" data-max-length="500" data-required="false"></textarea>
                 <div class="invalid-feedback">Máximo de 500 caracteres</div>
              </div>

              <div class="text-end mt-4">
                <button type="button" class="btn btn-outline-secondary me-2" id="btnVoltarPre">Voltar</button>
                <button type="submit" class="btn btn-success"> <i class="bi bi-check-lg"></i> Finalizar Registro</button>
              </div>
            </form>
          </div>
        </div>
      </section>

      <section id="telaVisualizacao" class="tela-sistema" style="display: none;">
         <div class="card shadow-sm mb-4">
             <div class="card-header bg-light d-flex justify-content-between align-items-center">
                 <h2 class="h5 mb-0"><i class="bi bi-eye me-2"></i> Visualização do Registro</h2>
                 <div>
                     <span id="registroIdVisualizar" class="badge bg-secondary me-2"></span>
                     <button class="btn btn-sm btn-outline-secondary me-2" id="btnVoltarLista">
                         <i class="bi bi-arrow-left"></i> Voltar à Lista
                     </button>
                     <button class="btn btn-sm btn-warning" id="btnEditarVisualizacao">
                         <i class="bi bi-pencil"></i> Editar
                     </button>
                 </div>
             </div>
             <div class="card-body">
                 <div class="mb-4">
                     <h5 class="form-section-title border-bottom pb-2">Informações Gerais</h5>
                     <div class="row g-3">
                         <div class="col-md-4"><strong>Placa:</strong> <span id="placaView">--</span></div>
                         <div class="col-md-4"><strong>Modelo:</strong> <span id="modeloView">--</span></div>
                         <div class="col-md-4"><strong>ID Interna:</strong> <span id="idInternaView">--</span></div>
                         <div class="col-md-4"><strong>Data Criação:</strong> <span id="dataView">--</span></div>
                         <div class="col-md-4"><strong>Responsável:</strong> <span id="responsavelView">--</span></div>
                         <div class="col-md-4"><strong>Status:</strong> <span id="statusView" class="badge">--</span></div>
                         <div class="col-md-6"><strong>Categoria:</strong> <span id="categoriaView">--</span></div>
                         <div class="col-md-6"><strong>Urgência:</strong> <span id="urgenciaView">--</span></div>
                         <div class="col-12"><strong>Problema:</strong> <p id="descricaoProblemaView" class="bg-light p-2 rounded">--</p></div>
                     </div>
                 </div>

                 <div class="row g-3">
                     <div class="col-md-6">
                         <div class="card h-100">
                             <div class="card-header bg-primary text-white">
                                 <h6 class="mb-0">PRÉ-Manutenção</h6>
                             </div>
                             <div class="card-body">
                                 <h6 class="mb-3">Checklist</h6>
                                 <table class="table table-sm table-bordered mb-3">
                                     <tbody id="checklistPreView"></tbody>
                                 </table>
                                 <h6 class="mb-3">Fotos</h6>
                                 <div id="fotosPreView" class="row g-2 mb-3"></div>
                                 <h6 class="mb-1">Observações</h6>
                                 <p id="observacoesPreView" class="text-muted">--</p>
                             </div>
                         </div>
                     </div>
                     <div class="col-md-6">
                         <div class="card h-100">
                             <div class="card-header bg-success text-white">
                                 <h6 class="mb-0">PÓS-Manutenção</h6>
                             </div>
                             <div class="card-body">
                                 <h6 class="mb-3">Checklist</h6>
                                 <table class="table table-sm table-bordered mb-3">
                                     <tbody id="checklistPosView"></tbody>
                                 </table>
                                 <h6 class="mb-3">Fotos</h6>
                                 <div id="fotosPosView" class="row g-2 mb-3"></div>
                                 <h6 class="mb-1">Observações</h6>
                                 <p id="observacoesPosView" class="text-muted">--</p>
                             </div>
                         </div>
                     </div>
                 </div>
             </div>
         </div>
     </section>
    </main>

    <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 1100">
      </div>

    <div id="loadingSpinner" class="position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center bg-dark bg-opacity-50" style="display: none; z-index: 9999;">
      <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
        <span class="visually-hidden">Carregando...</span>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>

    <script src="js/core/module-loader.js"></script> <script src="js/core/state.js"></script>
    <script src="js/core/cache-manager.js"></script>
    <script src="js/core/security.js"></script>
    <script src="js/core/performance-monitor.js"></script>

    <script src="js/api-client.js"></script>

    <script src="js/ui/theme-manager.js"></script>
    <script src="js/features/notifications.js"></script>
    <script src="js/auth/google-auth.js"></script>
    <script src="js/photo-handler.js"></script> <script src="js/features/dashboard.js"></script>
    <script src="js/app.js"></script>
    <script src="js/main.js"></script> </div>
</body>
</html>
